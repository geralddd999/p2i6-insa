{% extends 'base.html' %}
{% block content %}
<h1>Data browser</h1>

<style>
  summary      { cursor:pointer; font-weight:600; margin:.25rem 0; }
  ul.files li  { margin-left:1.5rem; opacity:.8; font-size:.9rem; }
  .btn         { margin-left:.5rem; font-size:.8rem; text-decoration:none; }
  #filter      { margin:.5rem 0 1rem; padding:.25rem .4rem; }
</style>

<input id="filter" placeholder="filterâ€¦" oninput="applyFilter()"/>

{% for year, months in tree.items() %}
<details open>
  <summary>
      {{ year }}
      <!-- NEW: download all months in one zip -->
      <a class="btn" href="/download/{{ year }}?token={{ token }}">zip</a>
  </summary>
  {% for month, files in months.items() %}
    <details>
      <summary>
        {{ month }}
        <a class="btn"
         href="/download/{{ year }}/{{ month }}?token={{ token }}">
         zip
        </a>
      </summary>
      <ul class="files">
        {% for f in files %}
          <li data-name="{{ f }}">{{ f }}</li>
        {% endfor %}
      </ul>
    </details>
  {% endfor %}
</details>
{% endfor %}

<script>
function applyFilter(){
  const term = document.getElementById('filter').value.toLowerCase()
  document.querySelectorAll('li[data-name]').forEach(li=>{
      li.style.display = li.dataset.name.toLowerCase().includes(term) ? '' : 'none'
  })
}
</script>
{% endblock %}
